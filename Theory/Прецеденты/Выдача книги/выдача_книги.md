# Прецедент: Оформление выдачи книги (Book Checkout Process)

## Описание:
Библиотекарь оформляет выдачу книги пользователю, проверяя её доступность и состояние в системе. Он фиксирует информацию о сроках возврата и обновляет статус книги. Процесс поиска книги заранее решается в другом прецеденте.

## Акторы:
- **Пользователь** (User): Хотит взять книгу на время.
- **Библиотекарь** (Librarian): Проводит процесс выдачи книги, проверяет её доступность, состояние и оформляет выдачу.
- **Система** (System): Обрабатывает информацию о пользователе, книге и сроках возврата.

## Интересы:
- **Пользователь**: Получить книгу на срок, удовлетворяя свои потребности.
- **Библиотекарь**: Оформить процесс выдачи книги, проверив её доступность и состояние, а также соблюдение всех библиотечных правил.

## Предусловия:
- Пользователь должен быть зарегистрирован в системе и не иметь задолженности (штрафы, просроченные книги).
- Книга должна быть в библиотечном фонде, доступна для выдачи (не повреждена, не на ремонте, не выдана другому пользователю).

## Постусловие:
- Книга успешно выдана пользователю.
- Статус книги обновлен на "выдана".
- Информация о сроках возврата и данных пользователя сохранена в системе.

---

## Успешный сценарий:

1. **Запрос на выдачу книги**  
   Пользователь обращается к библиотекарю с запросом на получение книги, указывая её название, автора или другие параметры (например, жанр).  
   (Поиск книги уже был осуществлён в другом прецеденте — **Поиск книги**.)

2. **Проверка доступности книги**  
   Библиотекарь проверяет в системе, доступна ли указанная книга для выдачи.  
   Система возвращает информацию о статусе книги (например, "доступна", "выдана", "на ремонте", "повреждена").

3. **Проверка состояния книги**  
   Если книга доступна, библиотекарь проверяет её физическое состояние.  
   Если книга повреждена, библиотекарь сообщает об этом пользователю и предлагает альтернативы (например, выбрать другую книгу или подождать завершения ремонта).

4. **Проверка задолженности пользователя**  
   Библиотекарь проверяет, нет ли у пользователя задолженности (штрафы, просроченные книги).  
   - Если у пользователя есть задолженность, система блокирует возможность выдачи.  
   - Библиотекарь сообщает о задолженности и предлагает погасить её, прежде чем оформить выдачу.

5. **Оформление выдачи книги**  
   Библиотекарь вносит данные о пользователе (ФИО, номер читательского билета) и фиксирует дату выдачи и срок возврата книги в системе.  
   Система сохраняет запись о выдаче книги с необходимыми данными.

6. **Передача книги пользователю**  
   Библиотекарь передает книгу пользователю, завершая процесс оформления.

7. **Обновление статуса книги**  
   Система обновляет статус книги на "выдана", а также фиксирует информацию о пользователе и сроке возврата.

8. **Завершение процесса**  
   Пользователь получает книгу, процесс выдачи завершен.

---

## Альтернативные сценарии:

1. **Книга недоступна**  
   Если книга недоступна (например, выдана другому пользователю или на ремонте):
   - Библиотекарь информирует пользователя и предлагает альтернативы:
     - Ожидание возвращения книги.
     - Выбор аналогичной книги.
     - Оформление заявки на книгу (если такая функция предусмотрена).

2. **Задолженность у пользователя**  
   Если у пользователя есть задолженность (штрафы или просроченные книги):
   - Система не позволяет оформить выдачу.
   - Библиотекарь сообщает пользователю о задолженности и предлагает погасить её или вернуть просроченные книги.

3. **Книга повреждена или на ремонте**  
   Если книга повреждена или находится на ремонте:
   - Библиотекарь сообщает пользователю, что книгу нельзя выдать.
   - Пользователю предлагаются альтернативы, например, выбрать аналогичную книгу или ожидать завершения ремонта.

---

## Исключения:

1. **Книга отсутствует в каталоге**  
   Если книга не зарегистрирована в каталоге или отсутствует в фонде:
   - Библиотекарь сообщает пользователю, что книга недоступна.
   - Варианты: запросить книгу в других библиотеках или выбрать аналогичную книгу.

2. **Неоплаченные штрафы или просроченные книги**  
   Если у пользователя есть неоплаченные штрафы или просроченные книги:
   - Система блокирует выдачу книги.
   - Библиотекарь сообщает пользователю и информирует о необходимости погасить задолженность.

3. **Книга повреждена или на ремонте**  
   Если книга не может быть выдана из-за повреждений или ремонта:
   - Библиотекарь сообщает об этом пользователю и предлагает альтернативы (например, выбрать другую книгу или подождать завершения ремонта).
